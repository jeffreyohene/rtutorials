---
title: "Dispersionsmaße"
output:
  learnr::tutorial:
    language: de
    css: css/boxes.css
    fig_caption: no
runtime: shiny_prerendered
bibliography: ref.json
link-citations: TRUE
description: Varianz, Standardabweichung
resource_files:
- css/boxes.css
---

```{r setup, include=FALSE}
library(learnr)
knitr::opts_chunk$set(echo = FALSE)
library(ggplot2)
```
## Intuition bekommen

### Was ist Streuung?
```{r ui}
            sliderInput("var",
                        "Varianz",
                        min = 0,
                        max = 50,
                        value = 5,
                        step = 0.1)

           plotOutput("distPlot")
```

```{r server, context = "server"}
 output$distPlot <- renderPlot({
       set.seed(1)
       y <- rnorm(5000, sd = sqrt(input$var))
       df <- data.frame(x = 1:5000, y)
       ggplot(df, aes(x, y)) +
         geom_hline(yintercept = 0, col = "blue") +
         geom_point(alpha = .4) +
         theme_void() +
         coord_cartesian(xlim = c(1, 5000), ylim = c(-25, +25))


    })
```


## Wie kann Streuung gemessen werden?

### Streuung als Abweichung von einem Zentrum

Es ist ein einfaches und geniales Konzept: 

Streuung wird gemessen durch die gesamte Abweichung aller Werte von einem Zentrum.

Das Zentrum ist meistens der Mittelwert, aber es gibt auch weniger gebräuchliche Maße, die z.B. den Median als Zentrum verwenden. Wir fokussieren uns jetzt aber auf die Abweichungen vom Mittelwert, weil das das Fundament für Varianz, Standardabweichung, Korrelation und Regression ist!

### Abweichungen vom Mittelwert

In Rot sehen sie den Abstand jedes einzelnen Werts zum Mittelwert.

```{r deviance}
y <- c(1, 1, 9, 3, 6)
res <- y - mean(y)
df <- data.frame(x = 1:5, y = y, res = res, meanres = (y + mean(y)) / 2)
ggplot(df, aes(x, y)) +
  geom_hline(yintercept = mean(y), color = "blue") +
  geom_linerange(aes(ymin = mean(y), ymax = y), color = "red") +
  geom_point(size = 3) +
  geom_label(label = res, aes(x = x + 0, y = meanres)) +
  scale_y_continuous(breaks = 0:10) +
  scale_x_continuous(breaks = NULL) +
  theme_bw() +
  labs(x = "", y = "x")
  
```


Die Abstände ergeben sich, wenn man den Mittelwert von jedem einzelnen Wert abzieht: 

$\large x_i - \bar x$

+-----------------+----------+----------+----------+----------+----------+
| $x_i$           | 1        | 1        | 3        | 6        | 9        |
+=================+=========:+=========:+=========:+=========:+=========:+
| $\bar{x}$       | 4        | 4        | 4        | 4        | 4        |
+-----------------+----------+----------+----------+----------+----------+
| $x_i - \bar{x}$ | -3       | -3       | -1       | 2        | 5        |
+-----------------+----------+----------+----------+----------+----------+

: Abweichungen vom Mittelwert

#### wichtige Eigenschaft des Mittelwerts

Interessanterweise ist der Mittelwert so definiert, dass sich die Abweichungen gegenseitig aufheben, wenn man sie alle addiert:

$$
{\large \sum_{i=1}^{n}{(x_i - \bar{x})}=0}
$$



Die Werte in der letzten Zeile stellen die Abweichungen vom Mittelwert dar. Wenn alle Werte der letzten Zeile addiert werden, kommt tatsächlich 0 heraus.

Das liegt an der Definition des Mittelwertes: Er liegt immer so, dass die negativen und die positiven Abweichungen sich gegenseitig aufheben.

Wie sähe eine mögliche Prüfung dieser Hypothese in R aus?


## Umsetzung

Um die Abweichungen vom Mittelwert ( $x_i - \bar{x}$ ) zu berechnen, wird der Mittelwert `mean(x)` von jedem einzelnen Wert des Vektors `x` abgezogen. Tatsächlich ist das in R so einfach, dass es fast nicht zu glauben ist - R's Mächtigkeit im Umgang mit Vektoren lässt grüßen!

```{r, echo=TRUE}
x <- c(1, 1, 9, 3, 6)
x - mean(x)
```

Als Ergebnis entsteht ein neuer Vektor mit den Abweichungen vom Mittelwert.

Jetzt sind Sie selber gefragt!

::: aufgabe
**Anwendungsaufgabe**

Prüfen Sie, ob die Summe aller Abweichungen vom Mittelwert wirklich 0 beträgt.

Übersetzen Sie dazu die Formel $\sum{(x_i - \bar{x})}=0$ in R Code!

Denken Sie an Ihre bereits erlangten Kenntnisse der letzten Tutorials.
:::

```{r deviation-setup}
x <- c(1, 1, 9, 3, 6)
```

```{r deviation-solution}
sum(x - mean(x)) == 0
```

```{r deviation-hint}
# Verwenden Sie sum() für die Formel und für die Überprüfung == 0 
```

```{r deviation, exercise=TRUE, exercise.setup = "deviation-setup", exercise.caption = "Abweichungen vom Mittelwert"}

```

Super! Aber das war erst der halbe Weg - Wie Sie sehen, heben sich die Abweichungen gegenseitig auf, und wir müssen noch etwas dagegen unternehmen, um zu einem sinnvollen Maß für die Streuung zu kommen. 

## Quadratsummen

Da die Abweichungen vom Mittelwert summiert immer 0 ergeben, geht ihr Informationsgehalt über die Streuung leider verloren. Um ein Maß für die Streuung (auch Dispersion genannt) zu erhalten, müssen noch zwei weitere Schritte geschehen:

Um zu verhindern, dass sich positive und negative Abweichungen aufheben, werden die einzelnen Abweichungen von Mittelwert quadriert. Das bringt den Vorteil mit sich, dass am Ende eine substantielle Kennzahl für die Streuung steht, aber auch den Nachteil, dass Extremwerte durch die Quadrierung sehr stark ins Gewicht fallen.\
Die Summe der quadrierten Abweichungen vom Mittelwert heißt Quadratsumme.

$$
{\large QS=\sum{(x_i-\bar{x})^2}}
$$

```{r deviance2, fig.height=5, fig.width=5, message=FALSE, warning=FALSE}
df$y2 <- df$y
df$y2[2] <- NA
df$yno2 <- df$y
df$yno2[-2] <- NA
df$res2 <- df$res
df$res2[2] <- NA
df$resno2 <- df$res
df$resno2[-2] <- NA

ggplot(df, aes(x, y)) +
  geom_rect(aes(ymin = mean(y), ymax = y2, xmin = x, xmax = x - abs(res)), fill = "pink", alpha = .6, col = "darkred") +
  geom_label(label = df$res2^2, aes(x = (x + (x - abs(res))) / 2, y = meanres)) +
  geom_rect(aes(ymin = mean(y), ymax = yno2, xmin = x, xmax = x - abs(res)), fill = "pink", alpha = .6, col = "darkred") +
  geom_label(label = df$resno2^2, aes(x = (x + (x - abs(res))) / 2, y = meanres)) +
  geom_point(size = 3) +
  geom_hline(yintercept = mean(y), color = "blue") +
  scale_y_continuous(breaks = 0:10) +
  scale_x_continuous(breaks = NULL) +
  theme_bw() +
  labs(x = "", y = "x")
  
```

+---------------------+---------:+---------:+---------:+---------:+---------:+
| $x_i - \bar{x}$     | -3       | -3       | 5        | -1       | 2        |
+---------------------+----------+----------+----------+----------+----------+
| $(x_i - \bar{x})^2$ | 9        | 9        | 25       | 1        | 4        |
+---------------------+----------+----------+----------+----------+----------+

: Quadrierte Abweichungen vom Mittelwert

<br>
$QS = 9 + 9+25+1+4=48$

Die Quadratsumme in unserem Beispiel beträgt 48. Mehr als die Hälfte dieses Werts (25) wurde durch einen einzigen Ausreißer verursacht.

Um daraus tatsächlich ein Maß der Streuung zu machen, müssen wir noch durch $n$ (die Anzahl der Elemente im Vektor) teilen, um den Einfluss der Stichprobengröße herauszurechnen. Es hat sich gezeigt, dass das Teilen durch $n - 1$ akkuratere Schätzungen liefert - eine genaue Erklärung dazu führt hier aber zu weit.

Damit haben wir die Formel der Varianz:

$$
{\large s^2 = {\frac{\sum{(x_i-\bar{x})^2}}{n-1}} }
$$

Die Formel für die Varianz des Beispiels würde so aussehen:

$$
{\large s^2 = {\frac{48}{4}}=12 }
$$

### Standardabweichung

Die Standardabweichung $s$ ist die Quadratwurzel der Varianz $s^2$.

$$
{\large s = \sqrt{s^2}}
$$

Die Standardabweichung ist lediglich eine transformierte Version der Varianz, das zugrundeliegende Messinstrument ist das selbe. Deswegen wird auch die Empfindlichkeit gegenüber Ausreißern, die der Quadratsumme eingeschrieben ist, wird durch das Ziehen der Wurzel nicht rückgängig gemacht, auch wenn es vielleicht auf den ersten Blick so scheint.

## Hausaufgabe

Ihre Hausaufgabe ist es, die Formeln der Varianz und Standabweichung als R Code umzusetzen. Vergleichen Sie Ihre Ergebnisse mit den Ergebnissen der eingebauten Funktionen `var()` und `sd()`. Nutzen Sie dafür die Gleichheitsbedingung `==`.

Speichern Sie die fertigen Formeln als Skript und laden Sie dieses als Abgabe auf Moodle hoch.

::: grau-nb
**Tipps**:

-   Die Quadratwurzel wird mit `sqrt()` (*square root*) gebildet.

-   Quadrieren mit `^2`

-   Auf die Klammersetzung achten: tendenziell verlangt R mehr Klammern als die normale mathematische Notation
:::

## Überblick deskriptivstatistische Kennwerte

Die Berechnung vieler statistischer Kennwerte ist in R ziemlich straight forward: Es gibt dafür oft eingebaute Funktionen, und wenn nicht, gibt es Pakete, die Funktionen enthalten. Immerhin wurde R entworfen mit dem Ziel, statistische Berechnungen zu ermöglichen.

Sie kennen nun bereits einige statistische Kennwerte. Es gibt noch viele mehr, und es geht nicht darum, sich alles zu merken, sondern zu wissen, wo Sie die passende Funktion für das gewünschte Maß finden. Oft reicht dafür eine kurze Suche im Internet.\
\
Alle diese Funktionen sind sich ähnlich: Sie nehmen als erstes Argument einen Vektor, der die Werte enthält, mit denen gerechnet werden soll. Deswegen haben Sie im ersten Teil gelernt, wie Sie Vektoren erstellen und speichern.

Hier nochmal eine Übersicht über deskriptivstatistische Kennwerte mit ihren eingebauten Funktionen:

+-----------------------+---------------------------+----------------+
| Name                  | Code                      | Skalenniveau   |
+=======================+===========================+================+
| arithmetisches Mittel | `mean()`                  | Intervall      |
+-----------------------+---------------------------+----------------+
| Median                | `median()`                | Ordinal        |
+-----------------------+---------------------------+----------------+
| Modus                 | `table()`\                | Nominal        |
|                       | oder mit externem Paket:\ |                |
|                       | `modeest::mfv()`          |                |
+-----------------------+---------------------------+----------------+
| Minimum und Maximum   | `range()`                 | Ordinal        |
+-----------------------+---------------------------+----------------+
| Spannweite            | `diff(range())`           | Intervall      |
+-----------------------+---------------------------+----------------+
| Quantile              | `quantile()`              | Ordinal        |
+-----------------------+---------------------------+----------------+
| Interquartilsabstand  | `IQR()`                   | Intervall      |
+-----------------------+---------------------------+----------------+
| Varianz               | `var()`                   | Intervall      |
+-----------------------+---------------------------+----------------+
| Standardabweichung    | `sd()`                    | Intervall      |
+-----------------------+---------------------------+----------------+

: Übersicht: Maße der zentralen Tendenz und Maße der Streuung in R

Hilfreich ist auch der Befehl `summary()`, der automatisch eine Zusammenfassung der wichtigen deskriptivstatistischen Kennwerte erstellt.

```{r test, exercise=TRUE, exercise.caption="Zum Ausprobieren"}

```

## Learnings

### neue Konzepte

-   nötige Skalenniveaus für Modus, Median und Mittelwert

-   Sinn von Abweichungen vom Mittelwert und Quadratsummen

-   Die Formel für die Varianz

### neue Funktionen

| Code               | Beschreibung                    |
|--------------------|---------------------------------|
| `var()`            | variance                        |
| `sd()`             | standard deviation              |
