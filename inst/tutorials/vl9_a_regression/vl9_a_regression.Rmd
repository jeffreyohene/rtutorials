---
title: "Regression"
output:
  learnr::tutorial:
    language: de
    css: css/boxes.css
    fig_caption: no
runtime: shiny_prerendered
bibliography: ref.json
link-citations: TRUE
description: Einführung in die einfache lineare Regression.
resource_files:
- css/boxes.css
---

```{r setup, include=FALSE}
library(learnr)
knitr::opts_chunk$set(echo = FALSE)
```

## Inhalt

-   Vorannahmen der Regression prüfen

## Lernziele

## Regression

Ein Beispiel:

Als Förster\*in möchtest du wissen, wie viele Kubikmeter Holz du von einem bestimmten Baum voraussichtlich ernten kannst. Gegeben ist dir für diese Vorhersage lediglich der Durchmesser des Baums.

Wir könnten das erwartete Volumen durch eine mathematische Formel aus dem Durchmesser berechnen. Genau das werden wir heute machen.

Dieses Verfahren nennt man auch modellieren (engl. *to fit a model*). Unser statistisches Modell sagt für einen gegebenen Durchmesser eine erwartete Holzernte voraus.

Dabei beschränken wir uns in diesem Kurs auf ein lineares Modell, das heißt, der Zusammenhang zwischen Durchmesser und vorausgesagter Holzmenge wird durch eine lineare Funktion beschrieben.

### lineare Funktionen

Die lineare Funktion kennen sicher alle noch aus der Schule, ca. 8. Klasse:

$$
\hat y = b_0 + b_1\cdot x_1
$$

oder in leicht abgewandelter Form:

$$
y = mx + n
$$

oder:

$$
y = a + bx
$$

Dabei steht $\hat y$ für den durch das Modell vorhergesagten Wert, auch engl. "*response variable"* genannt,"*output variable"* oder Kriterium. Im Beispiel wäre es das Holzvolumen in m³.

$x$ ist der Prädiktor, oder unser *input*, im Beispiel der Baumdurchmesser in Inches.

Daraus ergibt sich für uns folgendes Modell:

$$
\hat{Volumen} = b_0 + b_1 \cdot Durchmesser 
$$

::: infobox
Ein Dach über der Variable kennzeichnet immer, dass es sich hier um einen geschätzten Wert handelt.
:::

Aber was sind $b_0$ und $b_1$?

$b_0$ ist der vorhergesagte Wert, wenn $x$ 0 ist. Das ergibt sich aus der Gleichung:

$\hat y = b_0 + b_1 \cdot 0$

Bei einer Gerade ist $b_0$ also dort, wo $x = 0$. Das ist oft auch dort, wo die y-Achse verläuft, deswegen nennt man $b_0$ auch Achsenabschnitt oder *Intercept* auf Englisch.

$b_1$ ist die Änderung im vorhergesagten Wert ($\hat y$), wenn man $x$ um eine Einheit erhöht. 

Es erinnern sich bestimmt alle an das Dreieck, was man unter die Gerade zeichnen kann. 

```{r}
library(ggplot2)
.gerade <- function(x, intercept = 0, slope = 1){
  intercept + slope * x
}

ggplot() +
  stat_function(fun = `.gerade`, xlim = c(-1, 10), args = list(slope = -1.5, intercept = 9)) +
  geom_segment(aes(x = 2, y = 6, yend = 6, xend = 4), color = "red") +
  geom_segment(aes(x = 4, xend = 4, y = 6, yend = 3), color = "red") +
  coord_cartesian(xlim = c(0, 10), ylim = c(0, 10), expand = F) +
  scale_y_continuous(breaks = 0:10) +
  scale_x_continuous(breaks = 0:10) +
  theme_minimal()
```


```{r}

ggplot() +
  stat_function(fun = `.gerade`, xlim = c(0, 20),
                args = list(intercept = 5, slope = 0.5)) +
  stat_function(fun = `.gerade`, xlim = c(0, 20),
                args = list(intercept = 10, slope = 1), linetype = "dashed") +
  coord_cartesian(ylim = c(0, 20), xlim = c(0, 20)) +
  theme_minimal()
```

```{r guess}
quiz(
  question_numeric(
  "Welche Steigung (b1) hat die gestrichelte Linie?",
  answer(1, correct = T)
  ),
  question_numeric(
  "Welche Steigung (b1) hat die durchgezogene Linie?",
  answer(0.5, correct = T)
  ),
  question_numeric(
    "Welches Intercept (b0) hat die gestrichelte Linie?",
    answer(10, correct = T)
  ),
  question_numeric(
    "Welches Intercept (b0) hat die durchgezogene Linie?",
    answer(5, correct = T)
  ),
  caption = "Schulmathe auffrischen"
)
```

Um die Modellparameter $b_0$ und $b_1$ zu bestimmen, brauchen wir zunächst Daten, anhand derer das Modell "trainiert" wird.

Die sind uns gegeben in Form des `trees`-Datensatzes, der in Base R eingebaut ist. Dafür wurden 31 Amerikanische Traubenkirschen (*Prunus serotina*) ([wiki](https://de.wikipedia.org/wiki/Sp%C3%A4tbl%C3%BChende_Traubenkirsche)) gefällt und Durchmesser und geerntetes Holzvolumen gemessen.

In einem schnellen Scatterplot können wir die Beziehung zwischen Durchmesser und Volumen visuell überprüfen.


```{r echo=TRUE}
plot(trees$Girth, trees$Volume)
```

::: infobox
Der Durchmesser heißt in den Daten fälschlicherweise `Girth`, bezieht sich aber nicht auf den Umfang sondern den Durchmesser. (siehe `?trees`)
:::

Die Modellparameter $b_0$ und $b_1$ werden so bestimmt, dass sie eine Gerade beschreiben, die möglichst nah an allen Punkten dran ist.

Mathematisch ausgedrückt: Die Regressionsgerade liegt so, dass die Summe der quadrierten Abweichungen minimal ist.

Wenn es fertig ist, sieht es so aus:

```{r echo=TRUE}
plot(trees$Girth, trees$Volume)
abline(lm(Volume ~ Girth, data = trees))
```


## Abschlussquiz

## Learnings
